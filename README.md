# ä¸€ç¢—å°ç±³å‘¨ç™»å½•å¹³å°

ä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„ç»Ÿä¸€æˆæƒç™»å½•å¹³å°ï¼Œæ”¯æŒå¤šç§ç™»å½•æ–¹å¼å’Œç¬¬ä¸‰æ–¹ç™»å½•é›†æˆã€‚

æ­¤ç‰ˆæœ¬ä»¥åŠåç»­ç‰ˆæœ¬å‡ä¸ºå¼€æºï¼Œæ¬¢è¿å„ä½æå‡ºå»ºè®®ä¸æ–°åŠŸèƒ½
å¦‚æœ‰æ¼æ´æ¬¢è¿é€šè¿‡ä»¥ä¸‹è”ç³»æ–¹å¼è¿›è¡Œæäº¤:xz@mail.ihwx.cn

## é¡¹ç›®ç®€ä»‹

ä¸€ç¢—å°ç±³å‘¨å¼€æ”¾å¹³å°æ˜¯ä¸€ä¸ªåŸºäº PHP + PostgreSQL + Redis çš„ç»Ÿä¸€èº«ä»½è®¤è¯å’Œæˆæƒç®¡ç†ç³»ç»Ÿã€‚å®ƒä¸ºå¤šä¸ªåº”ç”¨æä¾›é›†ä¸­å¼çš„ç”¨æˆ·è®¤è¯æœåŠ¡ï¼Œæ”¯æŒä¼ ç»Ÿçš„è´¦å·å¯†ç ç™»å½•ã€éªŒè¯ç ç™»å½•ä»¥åŠå¤šç§ç¬¬ä¸‰æ–¹å¹³å°ç™»å½•ã€‚

æ–‡æ¡£è®¿é—®:https://docx.2hs.cn/web/#/664374947/252832761
## æ ¸å¿ƒç‰¹æ€§

### å¤šç§ç™»å½•æ–¹å¼

- **è´¦å·å¯†ç ç™»å½•**ï¼šæ”¯æŒç”¨æˆ·å/é‚®ç®±/æ‰‹æœºå·ç™»å½•
- **é‚®ç®±éªŒè¯ç ç™»å½•**ï¼šæ— éœ€è®°å¿†å¯†ç ï¼Œé‚®ç®±éªŒè¯ç å¿«é€Ÿç™»å½•
- **æ‰‹æœºéªŒè¯ç ç™»å½•**ï¼šçŸ­ä¿¡éªŒè¯ç ç™»å½•ï¼Œå®‰å…¨ä¾¿æ·
- **ç¬¬ä¸‰æ–¹ç™»å½•**ï¼š
  QQ ç™»å½•ã€å¾®ä¿¡ç™»å½•ã€å¾®åšç™»å½•ã€GitHub ç™»å½•ã€Google ç™»å½•

### ç”¨æˆ·ç®¡ç†

 ç”¨æˆ·æ³¨å†Œï¼ˆé‚®ç®±/æ‰‹æœºå·ï¼‰ã€ç”¨æˆ·èµ„æ–™ç®¡ç†ã€å¤´åƒä¸Šä¼ å’Œç®¡ç†ã€æ˜µç§°ç®¡ç†ã€è´¦å·ç»‘å®š/è§£ç»‘ç¬¬ä¸‰æ–¹å¹³å°

### åº”ç”¨ç®¡ç†

å¤šåº”ç”¨æ”¯æŒã€åº”ç”¨æƒé™é…ç½®ã€å›è°ƒåœ°å€ç®¡ç†ã€åº”ç”¨å¯†é’¥ç®¡ç†ã€ç™»å½•/æ³¨å†ŒåŠŸèƒ½å¼€å…³

### å®‰å…¨ç‰¹æ€§

å¯†ç åŠ å¯†ã€çŸ­ä¿¡éªŒè¯ç é™æµã€äººæœºéªŒè¯ï¼ˆéªŒè¯ç ï¼‰ã€IP é»‘ç™½åå•ã€ä¼šè¯ç®¡ç†ã€Token è®¤è¯

### æ•°æ®å­˜å‚¨

PostgreSQL æ•°æ®åº“ã€Redis ç¼“å­˜ã€å¤š Schema æ¶æ„

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- PHP >= 7.4ï¼ˆä¸ç¡®å®šï¼ŒåŸºäºPHP8.4å¼€å‘ï¼‰
- PostgreSQL >= 17
- Redis >= 7.2
- PHP æ‰©å±•ï¼š
  - pdo
  - pdo_pgsql
  - redis
  - curl
  - json
  - mbstring

### å®‰è£…æ­¥éª¤

1. **è®¿é—®å®‰è£…å‘å¯¼**

http://your-domain/auth/install/


2. **æŒ‰ç…§å‘å¯¼å®Œæˆ 6 ä¸ªæ­¥éª¤**

- ç¯å¢ƒæ£€æŸ¥
- æ•°æ®åº“é…ç½®
- ç«™ç‚¹é…ç½®
- æ•°æ®åº“å®‰è£…
- åˆ›å»ºç®¡ç†å‘˜
- å®Œæˆå®‰è£…

3. **åˆ é™¤å®‰è£…ç›®å½•**

```bash
rm -rf auth/install/
```

### é…ç½®ç¬¬ä¸‰æ–¹ç™»å½•

å®‰è£…å®Œæˆåï¼Œéœ€è¦é…ç½®ç¬¬ä¸‰æ–¹ç™»å½•å¹³å°ï¼š


## ğŸ“ ç›®å½•ç»“æ„

```
auth/
â”œâ”€â”€ admin/                  # ç®¡ç†åå°ï¼ˆå¾…å¼€å‘ï¼‰
â”œâ”€â”€ agreement/              # åè®®é¡µé¢
â”‚   â”œâ”€â”€ privacy.html       # éšç§æ”¿ç­–
â”‚   â””â”€â”€ terms.html         # æœåŠ¡æ¡æ¬¾
â”œâ”€â”€ api/                    # API æ¥å£
â”‚   â”œâ”€â”€ login.php          # ç™»å½•æ¥å£
â”‚   â”œâ”€â”€ register.php       # æ³¨å†Œæ¥å£
â”‚   â””â”€â”€ ...
â”œâ”€â”€ captcha/                # äººæœºéªŒè¯æœåŠ¡
â”œâ”€â”€ checks/                 # æ£€æŸ¥æœåŠ¡ï¼ˆå¤´åƒã€æ˜µç§°ç­‰ï¼‰
â”œâ”€â”€ config/                 # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ postgresql.config.php  # æ•°æ®åº“é…ç½®
â”‚   â””â”€â”€ redis.config.php       # Redis é…ç½®
â”œâ”€â”€ css/                    # æ ·å¼æ–‡ä»¶
â”œâ”€â”€ doc/                    # æ–‡æ¡£
â”œâ”€â”€ images/                 # å›¾ç‰‡èµ„æº
â”œâ”€â”€ install/                # å®‰è£…å‘å¯¼
â”‚   â”œâ”€â”€ index.php          # å®‰è£…ä¸»é¡µ
â”‚   â”œâ”€â”€ install.js         # å®‰è£…è„šæœ¬
â”‚   â”œâ”€â”€ install.css        # å®‰è£…æ ·å¼
â”‚   â””â”€â”€ install_handler.php # å®‰è£…å¤„ç†å™¨
â”œâ”€â”€ js/                     # JavaScript æ–‡ä»¶
â”œâ”€â”€ login/                  # ç™»å½•é¡µé¢
â”‚   â”œâ”€â”€ index.html         # ç™»å½•ä¸»é¡µ
â”‚   â””â”€â”€ thirdparty/        # ç¬¬ä¸‰æ–¹ç™»å½•
â”‚       â”œâ”€â”€ qq/            # QQ ç™»å½•
â”‚       â”œâ”€â”€ wechat/        # å¾®ä¿¡ç™»å½•
â”‚       â”œâ”€â”€ weibo/         # å¾®åšç™»å½•
â”‚       â”œâ”€â”€ github/        # GitHub ç™»å½•
â”‚       â””â”€â”€ google/        # Google ç™»å½•
â”œâ”€â”€ logs/                   # æ—¥å¿—ç›®å½•
â”œâ”€â”€ mail/                   # é‚®ä»¶æœåŠ¡
â”œâ”€â”€ register/               # æ³¨å†Œé¡µé¢
â”œâ”€â”€ sms/                    # çŸ­ä¿¡æœåŠ¡
â”œâ”€â”€ sql/                    # SQL è„šæœ¬
â”‚   â”œâ”€â”€ users.sql          # ç”¨æˆ·è¡¨
â”‚   â”œâ”€â”€ site.sql           # ç«™ç‚¹é…ç½®è¡¨
â”‚   â”œâ”€â”€ tokens.sql         # Token è¡¨
â”‚   â””â”€â”€ ...
â”œâ”€â”€ storage/                # å­˜å‚¨ç›®å½•
â”œâ”€â”€ user/                   # ç”¨æˆ·ä¸­å¿ƒ
â”‚   â”œâ”€â”€ index.html         # ç”¨æˆ·ä¸­å¿ƒä¸»é¡µ
â”‚   â”œâ”€â”€ login.php          # ç”¨æˆ·ä¸­å¿ƒç™»å½•
â”‚   â””â”€â”€ callback/          # ç™»å½•å›è°ƒ
â”œâ”€â”€ index.html              # å¹³å°é¦–é¡µ
â””â”€â”€ README.md               # æœ¬æ–‡ä»¶
```

## é…ç½®è¯´æ˜

### æ•°æ®åº“é…ç½®

åœ¨è¿è¡Œå®‰è£…è„šæœ¬æ—¶ï¼Œä¼šè‡ªåŠ¨é…ç½®ï¼Œä½ ä¸éœ€è¦æ‰‹åŠ¨ç¼–è¾‘ã€‚

ç¼–è¾‘ `config/postgresql.config.php`ï¼š

```php
define('DB_HOST', 'localhost');
define('DB_PORT', '5432');
define('DB_NAME', 'auth_db');
define('DB_USER', 'postgres');
define('DB_PASSWORD', 'your_password');
```

### Redis é…ç½®

ç¼–è¾‘ `config/redis.config.php`ï¼š

```php
define('REDIS_HOST', 'localhost');
define('REDIS_PORT', 6379);
define('REDIS_PASSWORD', 'your_password');
```

### åº”ç”¨é…ç½®

åœ¨æ•°æ®åº“ `site_configs.site_config` è¡¨ä¸­é…ç½®åº”ç”¨ä¿¡æ¯ï¼š

- `app_id`ï¼šåº”ç”¨å”¯ä¸€æ ‡è¯†
- `secret_key`ï¼šåº”ç”¨å¯†é’¥
- `site_url`ï¼šåº”ç”¨åœ°å€
- `callback_urls`ï¼šå›è°ƒåœ°å€åˆ—è¡¨
- `permissions`ï¼šæƒé™åˆ—è¡¨
- å„ç§åŠŸèƒ½å¼€å…³
