<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ£€æŸ¥ JS æ–‡ä»¶ç‰ˆæœ¬</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .result {
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
            border-left: 4px solid #2196F3;
            border-radius: 4px;
        }
        .success {
            border-left-color: #4CAF50;
            background: #e8f5e9;
        }
        .error {
            border-left-color: #f44336;
            background: #ffebee;
        }
        pre {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
            max-height: 400px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        .info {
            background: #e3f2fd;
            border-left-color: #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” æ£€æŸ¥ login.js æ–‡ä»¶ç‰ˆæœ¬</h1>
        
        <div class="info">
            <strong>è¯´æ˜ï¼š</strong>æ­¤é¡µé¢ç”¨äºæ£€æŸ¥æœåŠ¡å™¨ä¸Šçš„ login.js æ–‡ä»¶æ˜¯å¦åŒ…å«æ–°çš„ GetCaptchaConfig.php API è°ƒç”¨ã€‚
        </div>

        <button onclick="checkJsFile()">æ£€æŸ¥ login.js æ–‡ä»¶</button>
        <button onclick="checkWithTimestamp()">å¼ºåˆ¶åˆ·æ–°æ£€æŸ¥ï¼ˆå¸¦æ—¶é—´æˆ³ï¼‰</button>
        <button onclick="location.reload(true)">ç¡¬åˆ·æ–°æ­¤é¡µé¢</button>

        <div id="result"></div>
    </div>

    <script>
        async function checkJsFile() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<div class="result">æ­£åœ¨æ£€æŸ¥...</div>';

            try {
                // è·å– login.js æ–‡ä»¶å†…å®¹
                const response = await fetch('js/login.js');
                const content = await response.text();

                // æ£€æŸ¥æ˜¯å¦åŒ…å«æ–°çš„ API
                const hasNewAPI = content.includes('GetCaptchaConfig.php');
                const hasOldAPI = content.includes('GetGeetestConfig.php');
                const hasInitCaptcha = content.includes('async function initCaptcha()');
                const hasInitTurnstile = content.includes('async function initTurnstile()');

                let html = '<div class="result">';
                html += '<h3>æ£€æŸ¥ç»“æœï¼š</h3>';
                html += '<ul>';
                html += `<li>æ–‡ä»¶å¤§å°ï¼š${content.length} å­—èŠ‚</li>`;
                html += `<li>åŒ…å« GetCaptchaConfig.phpï¼š${hasNewAPI ? 'âœ… æ˜¯' : 'âŒ å¦'}</li>`;
                html += `<li>åŒ…å« GetGeetestConfig.phpï¼š${hasOldAPI ? 'âš ï¸ æ˜¯ï¼ˆæ—§ç‰ˆæœ¬ï¼‰' : 'âœ… å¦'}</li>`;
                html += `<li>åŒ…å« initCaptcha å‡½æ•°ï¼š${hasInitCaptcha ? 'âœ… æ˜¯' : 'âŒ å¦'}</li>`;
                html += `<li>åŒ…å« initTurnstile å‡½æ•°ï¼š${hasInitTurnstile ? 'âœ… æ˜¯' : 'âŒ å¦'}</li>`;
                html += '</ul>';

                if (hasNewAPI && !hasOldAPI && hasInitCaptcha && hasInitTurnstile) {
                    html += '<p style="color: #4CAF50; font-weight: bold;">âœ… æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼</p>';
                    html += '<p>å¦‚æœæµè§ˆå™¨è¿˜åœ¨è¯·æ±‚æ—§ APIï¼Œè¯·æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼š</p>';
                    html += '<ol>';
                    html += '<li>æŒ‰ Ctrl+Shift+Delete æ‰“å¼€æ¸…é™¤ç¼“å­˜å¯¹è¯æ¡†</li>';
                    html += '<li>é€‰æ‹©"å…¨éƒ¨æ—¶é—´"</li>';
                    html += '<li>å‹¾é€‰"ç¼“å­˜çš„å›¾ç‰‡å’Œæ–‡ä»¶"</li>';
                    html += '<li>ç‚¹å‡»"æ¸…é™¤æ•°æ®"</li>';
                    html += '<li>å®Œå…¨å…³é—­æµè§ˆå™¨åé‡æ–°æ‰“å¼€</li>';
                    html += '</ol>';
                } else if (hasOldAPI) {
                    html += '<p style="color: #f44336; font-weight: bold;">âŒ æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶è¿˜æ˜¯æ—§ç‰ˆæœ¬ï¼</p>';
                    html += '<p>è¯·æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æ­£ç¡®ä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚</p>';
                } else {
                    html += '<p style="color: #ff9800; font-weight: bold;">âš ï¸ æ–‡ä»¶çŠ¶æ€å¼‚å¸¸</p>';
                }

                html += '</div>';

                // æ˜¾ç¤ºéƒ¨åˆ†æ–‡ä»¶å†…å®¹
                const initCaptchaMatch = content.match(/async function initCaptcha\(\)[\s\S]{0,500}/);
                if (initCaptchaMatch) {
                    html += '<div class="result">';
                    html += '<h3>initCaptcha å‡½æ•°ç‰‡æ®µï¼š</h3>';
                    html += '<pre>' + escapeHtml(initCaptchaMatch[0]) + '...</pre>';
                    html += '</div>';
                }

                resultDiv.innerHTML = html;

            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">
                    <h3>æ£€æŸ¥å¤±è´¥ï¼š</h3>
                    <p>${error.message}</p>
                </div>`;
            }
        }

        async function checkWithTimestamp() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<div class="result">æ­£åœ¨æ£€æŸ¥ï¼ˆå¼ºåˆ¶åˆ·æ–°ï¼‰...</div>';

            try {
                // æ·»åŠ æ—¶é—´æˆ³å‚æ•°å¼ºåˆ¶åˆ·æ–°
                const timestamp = new Date().getTime();
                const response = await fetch(`js/login.js?t=${timestamp}`);
                const content = await response.text();

                // æ£€æŸ¥æ˜¯å¦åŒ…å«æ–°çš„ API
                const hasNewAPI = content.includes('GetCaptchaConfig.php');
                const hasOldAPI = content.includes('GetGeetestConfig.php');

                let html = '<div class="result ' + (hasNewAPI && !hasOldAPI ? 'success' : 'error') + '">';
                html += '<h3>å¼ºåˆ¶åˆ·æ–°æ£€æŸ¥ç»“æœï¼š</h3>';
                html += '<ul>';
                html += `<li>è¯·æ±‚ URLï¼šjs/login.js?t=${timestamp}</li>`;
                html += `<li>æ–‡ä»¶å¤§å°ï¼š${content.length} å­—èŠ‚</li>`;
                html += `<li>åŒ…å« GetCaptchaConfig.phpï¼š${hasNewAPI ? 'âœ… æ˜¯' : 'âŒ å¦'}</li>`;
                html += `<li>åŒ…å« GetGeetestConfig.phpï¼š${hasOldAPI ? 'âš ï¸ æ˜¯ï¼ˆæ—§ç‰ˆæœ¬ï¼‰' : 'âœ… å¦'}</li>`;
                html += '</ul>';

                if (hasNewAPI && !hasOldAPI) {
                    html += '<p style="color: #4CAF50; font-weight: bold;">âœ… æ–‡ä»¶ç¡®è®¤æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼</p>';
                    html += '<p><strong>ä¸‹ä¸€æ­¥ï¼š</strong>è¯·åœ¨ç™»å½•é¡µé¢æŒ‰ Ctrl+Shift+R ç¡¬åˆ·æ–°ï¼Œæˆ–å®Œå…¨æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ã€‚</p>';
                } else {
                    html += '<p style="color: #f44336; font-weight: bold;">âŒ æ–‡ä»¶è¿˜æ˜¯æ—§ç‰ˆæœ¬ï¼</p>';
                    html += '<p>è¯·ç¡®è®¤æ–‡ä»¶å·²æ­£ç¡®ä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚</p>';
                }

                html += '</div>';
                resultDiv.innerHTML = html;

            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">
                    <h3>æ£€æŸ¥å¤±è´¥ï¼š</h3>
                    <p>${error.message}</p>
                </div>`;
            }
        }

        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', () => {
            checkJsFile();
        });
    </script>
</body>
</html>
